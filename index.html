<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página Profissional</title>
    <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f5f6f5;
            display: flex;
            height: 100vh;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        .watermark {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://i.imgur.com/aXi6GXi.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50%;
            opacity: 0.3;
            z-index: 999;
            pointer-events: none;
        }
        .topbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background-color: #1A2526;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            box-sizing: border-box;
            z-index: 3000; /* Aumentado para garantir que fique acima do iframe */
            display: none;
        }
        .topbar.active {
            display: flex;
        }
        .company-logo {
            max-width: 150px;
            height: auto;
            object-fit: contain;
        }
        .profile-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .profile-logo {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            order: 2;
        }
        .profile-name {
            color: #ffffff;
            font-size: 14px;
            font-weight: bold;
            display: none;
            order: 1;
        }
        .profile-name.active {
            display: block;
        }
        .dropdown-menu {
            position: absolute;
            top: 40px;
            right: 0;
            background-color: #2C3E50;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            width: 120px;
            z-index: 3100;
        }
        .dropdown-menu.active {
            display: flex;
        }
        .dropdown-menu a {
            color: #ffffff;
            padding: 8px;
            text-decoration: none;
            text-align: center;
            transition: background-color 0.3s;
        }
        .dropdown-menu a:hover, .dropdown-menu a:focus {
            background-color: #34495E;
            outline: none;
        }
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background: url('https://i.imgur.com/F0ttiSc.jpeg') no-repeat center/cover;
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: 1000;
        }
        .login-box {
            background: rgba(26, 37, 38, 0.95);
            backdrop-filter: blur(5px);
            padding: 30px;
            border-radius: 10px;
            border: 1px solid #2C3E50;
            text-align: center;
            width: 90%;
            max-width: 460px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            position: relative;
            color: #ffffff;
            z-index: 1001;
        }
        .login-logos {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
        }
        .login-logo {
            max-width: 250px;
            height: auto;
            object-fit: contain;
        }
        .user-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .user-option {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            background-color: #2c3e5059;
        }
        .user-option:hover {
            background-color: #34495E;
        }
        .user-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #ffffff;
            margin-right: 15px;
            object-fit: cover;
        }
        .user-name {
            font-size: 18px;
            color: #ffffff;
            font-weight: bold;
        }
        .login-form {
            margin-top: 20px;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: opacity 0.3s ease, max-height 0.3s ease;
        }
        .login-form.active {
            opacity: 1;
            max-height: 200px;
        }
        .login-box label {
            display: block;
            text-align: left;
            margin-bottom: 5px;
            font-size: 14px;
            color: #ffffff;
        }
        .login-box input {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #2C3E50;
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
            background-color: #ffffff;
            color: #333;
        }
        .login-box button {
            padding: 10px;
            border-radius: 5px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        .login-box button[type="submit"] {
            background-color: #34495E;
            color: white;
        }
        .login-box button[type="submit"].btn-hover:hover {
            background-color: #4A6076;
        }
        .login-box button.back-btn {
            background-color: #2C3E50;
            color: #ffffff;
        }
        .login-box button.back-btn.btn-hover:hover {
            background-color: #34495E;
        }
        .spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ffffff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: none;
        }
        .sidebar {
            position: fixed;
            left: -200px;
            top: 40px;
            height: calc(100% - 40px);
            width: 200px;
            background-color: #1A2526;
            padding: 15px;
            transition: left 0.3s ease;
            box-sizing: border-box;
            z-index: 2000;
        }
        .sidebar.active {
            left: 0;
        }
        .menu a {
            display: block;
            color: white;
            padding: 12px;
            margin-bottom: 8px;
            text-decoration: none;
            border-radius: 5px;
            background-color: #2C3E50;
            transition: background-color 0.3s;
            border: 1px solid #34495E;
        }
        .menu a.btn-hover:hover {
            background-color: #34495E;
        }
        .submenu {
            display: none;
            padding-left: 20px;
            margin-top: 4px;
        }
        .submenu.active {
            display: block;
        }
        .submenu a {
            background-color: #34495E;
            font-size: 14px;
            padding: 10px;
        }
        .submenu a.btn-hover:hover {
            background-color: #4A6076;
        }
        .content {
            margin-left: 0;
            padding: 0;
            flex: 1;
            transition: margin-left 0.3s ease;
            margin-top: 40px; /* Espaço para a topbar */
            display: none;
            box-sizing: border-box;
            height: calc(100vh - 40px);
            overflow: hidden; /* Evita vazamento do fundo */
            z-index: 1001;
        }
        .content.active {
            display: block;
        }
        .sidebar.active + .content {
            margin-left: 200px;
        }
        .agenda {
            background-color: #fff; /* Fundo branco para evitar vazamento */
            padding: 0;
            margin: 0;
            border-radius: 0;
            box-shadow: none;
            position: relative;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            z-index: 1001;
            overflow: hidden; /* Garante que o fundo não vaze */
        }
        .agenda > div {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        .agenda iframe {
            width: 100%;
            height: 100%;
            border: 0;
            margin: 0;
            padding: 0;
            position: absolute;
            top: 0; /* Alinha exatamente no topo */
            left: 0;
            box-sizing: border-box;
            background-color: #fff; /* Fundo branco para evitar vazamento */
        }
        .carousel {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 1200px;
            margin: 0 auto;
            display: none;
        }
        .carousel iframe {
            width: 100%;
            height: 100%;
            border: 0;
            margin: 0;
            padding: 0;
            border-radius: 0;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
            visibility: visible;
            background-color: #fff;
        }
        .carousel iframe.active {
            display: block;
        }
        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(26, 37, 38, 0.7);
            color: white;
            border: none;
            padding: 15px;
            cursor: pointer;
            font-size: 24px;
            z-index: 2000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }
        .carousel-btn.btn-hover:hover {
            background: rgba(26, 37, 38, 0.9);
        }
        .carousel-btn.prev {
            left: 10px;
        }
        .carousel-btn.next {
            right: 10px;
        }
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            color: white;
            flex-direction: column;
            gap: 10px;
            z-index: 1500;
        }
        .calendar-container, .form-container {
            width: 100%;
            height: 100%;
            position: relative;
            border: none;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        .calendar-container iframe, .form-container iframe {
            border: 0;
            border-radius: 0;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            box-shadow: none;
            background: #fff;
            width: 100%;
            height: 100%;
            min-width: 100%;
            min-height: 100%;
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }
        .sidebar-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1A2526;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            transition: background 0.3s;
            border: 1px solid #2C3E50;
        }
        .sidebar-toggle.btn-hover:hover {
            background: #2C3E50;
        }
        .btn-hover:hover {
            background-color: #34495E;
        }
        .table-container {
            max-height: calc(100% - 40px);
            overflow-y: auto;
            overflow-x: auto;
        }
        #dataTable {
            border-collapse: collapse;
            width: 100%;
            margin: 0;
            border: 1px solid #2C3E50;
        }
        #dataTable th, #dataTable td {
            border: 1px solid #2C3E50;
            padding: 8px;
            text-align: left;
            white-space: nowrap;
        }
        #dataTable th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
            z-index: 1500;
        }
        #dataTable tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        #dataTable a {
            color: #0066cc;
            text-decoration: none;
        }
        #dataTable a:hover {
            text-decoration: underline;
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        .birthday-calendar {
            background-color: rgba(255, 255, 255, 0.95);
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            color: #333;
            width: 100%;
            min-height: 100%;
            max-height: 100%;
            overflow-y: auto;
            padding: 2%;
            box-sizing: border-box;
            position: relative;
            border: 1px solid #2C3E50;
            border-radius: 10px;
            z-index: 1001;
        }
        .birthday-calendar h1 {
            text-align: center;
            color: #fff;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 1rem;
            border-radius: 8px;
            margin: 0 0 2rem;
            font-size: clamp(1.5rem, 5vw, 2rem);
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            box-sizing: border-box;
        }
        .month {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            box-sizing: border-box;
            border: 1px solid #2C3E50;
        }
        .month h2 {
            margin: 0 0 0.5rem;
            background-color: #d32f2f;
            color: #fff;
            font-size: clamp(1rem, 3vw, 1.2rem);
            text-align: center;
            padding: 0.5rem;
            border-radius: 5px;
        }
        .birthday {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }
        .birthday img {
            width: clamp(40px, 10vw, 50px);
            height: clamp(40px, 10vw, 50px);
            border-radius: 5px;
            object-fit: cover;
            padding: 0.3rem 0.3rem 0.8rem 0.3rem;
            background-color: #fff;
            border: 1px solid #2C3E50;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
            transform: rotate(2deg);
            margin-right: 0.6rem;
            cursor: pointer;
            z-index: 1002;
        }
        .birthday img:nth-child(odd) {
            transform: rotate(-2deg);
        }
        .birthday span {
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
            color: #34495e;
            flex: 1;
        }
        .fullscreen-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 4000;
            cursor: pointer;
        }
        .fullscreen-image {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border: 2px solid #fff;
            border-radius: 8px;
        }
        .birthday-notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background-color: #d32f2f;
            color: #fff;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 300px;
            z-index: 3000;
            box-sizing: border-box;
            border: 1px solid #2C3E50;
        }
        .birthday-notification h3 {
            margin: 0 0 0.5rem;
            font-size: clamp(1rem, 3vw, 1.2rem);
        }
        .birthday-notification ul {
            margin: 0;
            padding: 0 0 0 1rem;
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
        }
        .birthday-notification li {
            margin-bottom: 0.3rem;
        }
        .birthday-notification .close-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            color: #fff;
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            cursor: pointer;
            z-index: 3001;
        }
        @media (max-width: 900px) {
            .calendar-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }
            .birthday-calendar h1 {
                font-size: clamp(1.2rem, 4vw, 1.8rem);
            }
            .month {
                padding: 0.8rem;
            }
        }
        @media (max-width: 600px) {
            .calendar-grid {
                grid-template-columns: 1fr;
                padding: 0 0.5rem;
            }
            .birthday-calendar {
                padding: 1%;
            }
            .birthday-notification {
                width: 95%;
                max-width: 280px;
                top: 0.5rem;
                right: 0.5rem;
            }
            .birthday img {
                width: clamp(35px, 8vw, 45px);
                height: clamp(35px, 8vw, 45px);
            }
            .birthday span {
                font-size: clamp(0.7rem, 2.2vw, 0.85rem);
            }
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 150px;
            }
            .sidebar.active + .content {
                margin-left: 150px;
            }
            .login-box {
                width: 90%;
                max-width: 300px;
            }
            .company-logo {
                max-width: 150px;
                height: auto;
            }
            .login-logo {
                max-width: 120px;
            }
            .carousel, .calendar-container, .birthday-calendar {
                height: 100%;
            }
            .carousel-btn.prev {
                left: 5px;
            }
            .carousel-btn.next {
                right: 5px;
            }
            .profile-name {
                font-size: 12px;
            }
            .sidebar-toggle {
                bottom: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="watermark"></div>
    <script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
            return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
            if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
                try {
                    var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                    var firstSheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[firstSheetName];
                    var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                    var filteredData = jsonData.filter(row => row.some(filledCell));
                    var headerRowIndex = filteredData.findIndex((row, index) =>
                        row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                    );
                    if (headerRowIndex === -1 || headerRowIndex > 25) {
                        headerRowIndex = 0;
                    }
                    var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
                    csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                    return csv;
                } catch (e) {
                    console.error(e);
                    return "";
                }
            }
            return gk_fileData[filename] || "";
        }

        function parseCSV(csvText) {
            const rows = [];
            let currentRow = [];
            let currentField = '';
            let insideQuotes = false;

            for (let i = 0; i < csvText.length; i++) {
                const char = csvText[i];

                if (char === '"') {
                    insideQuotes = !insideQuotes;
                } else if (char === ',' && !insideQuotes) {
                    currentRow.push(currentField.trim());
                    currentField = '';
                } else if (char === '\n' && !insideQuotes) {
                    currentRow.push(currentField.trim());
                    if (currentRow.some(filledCell)) {
                        rows.push(currentRow);
                    }
                    currentRow = [];
                    currentField = '';
                } else {
                    currentField += char;
                }
            }

            if (currentField || currentRow.length) {
                currentRow.push(currentField.trim());
                if (currentRow.some(filledCell)) {
                    rows.push(currentRow);
                }
            }

            return rows;
        }
    </script>

    <div class="topbar" id="topbar">
        <img id="company-logo" class="company-logo" src="https://i.imgur.com/UUAKcJl.png" alt="Logo da Empresa" onerror="this.src='https://via.placeholder.com/80?text=Logo+Indisponível';">
        <div class="profile-container">
            <span id="profile-name" class="profile-name"></span>
            <img id="profile-logo" class="profile-logo" src="" alt="Logo do Perfil" onclick="toggleDropdown()">
            <div class="dropdown-menu" id="dropdown-menu">
                <a href="#" onclick="loadBirthdays()">Aniversários</a>
                <a href="#" onclick="logout()">Sair</a>
            </div>
        </div>
    </div>

    <button class="sidebar-toggle btn-hover" id="sidebar-toggle" aria-label="Alternar barra lateral">☰</button>

    <div class="login-container" id="login-container" role="dialog" aria-label="Tela de Login">
        <div class="login-box">
            <div class="login-logos">
                <img class="login-logo" src="https://i.imgur.com/UUAKcJl.png" alt="Logo da Empresa" onerror="this.src='https://via.placeholder.com/150?text=Logo+Indisponível';">
                <img class="login-logo" src="https://i.imgur.com/WAh7GhF.png" alt="Logo da Empresa Parceira" onerror="this.src='https://via.placeholder.com/150?text=Logo+Indisponível';">
            </div>
            <div class="user-list" id="user-list"></div>
            <div class="spinner" id="login-spinner"></div>
            <form id="login-form" class="login-form" onsubmit="handleLogin(event)">
                <label for="password">Senha:</label>
                <input type="password" id="password" name="password" placeholder="Digite sua senha" required aria-label="Senha">
                <button type="submit" class="btn-hover">Entrar</button>
                <button type="button" class="back-btn btn-hover" onclick="updateLoginScreen()">Voltar</button>
            </form>
        </div>
    </div>

    <nav class="sidebar" id="sidebar" role="navigation" aria-label="Menu Principal">
        <div class="menu" id="menu"></div>
    </nav>

    <main class="content" id="content" role="main">
        <div class="agenda" id="agenda">
            <div class="loading-overlay" id="loading-overlay">
                <span>Carregando...</span>
                <button onclick="reloadIframe()" style="padding: 5px 10px; background: #1A2526; color: white; border: none; border-radius: 5px; cursor: pointer;">Tentar Novamente</button>
            </div>
            <div class="carousel" id="carousel">
                <button class="carousel-btn prev btn-hover" onclick="prevIframe()" aria-label="Iframe anterior">❮</button>
                <iframe id="iframe1" src="https://lookerstudio.google.com/embed/reporting/cde54bf6-cff4-4d3d-a416-58765cd2c894/page/Z0wDF" allowfullscreen sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox" onload="hideLoading()" onerror="handleIframeError()"></iframe>
                <iframe id="iframe2" src="https://lookerstudio.google.com/embed/reporting/74748bad-da33-4d1a-9faa-5c8502e76264/page/lxfEF" allowfullscreen sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox" onload="hideLoading()" onerror="handleIframeError()"></iframe>
                <button class="carousel-btn next btn-hover" onclick="nextIframe()" aria-label="Próximo iframe">❯</button>
            </div>
        </div>
    </main>

    <script>
        const users = {
            admin: { name: 'Administrador', token: 'admin123', profilePhoto: 'https://i.imgur.com/f2EnSQC.png' },
            contratos: { name: 'Contratos', token: 'contratos123', profilePhoto: 'https://i.imgur.com/f2EnSQC.png' },
            fundos: { name: 'Fundos', token: 'fundos123', profilePhoto: 'https://i.imgur.com/f2EnSQC.png' },
            support: { name: 'Support - TI', token: 'support123', profilePhoto: 'https://i.imgur.com/f2EnSQC.png' }
        };

        const mockValidatePassword = (username, password) => {
            const mockPasswords = { 
                admin: 'adminpass', 
                contratos: 'contratospass', 
                fundos: 'fundospass', 
                support: 'Ti123' 
            };
            return mockPasswords[username] === password;
        };

        const menuOptions = {
            admin: [
                { text: 'Email', url: 'https://mail.parauapebas.pa.gov.br/' },
                { text: 'Agenda', url: 'https://calendar.google.com/calendar/embed?src=31521d58fdb5f7855743d3410dfa9d44390e0d314cd1aa38dd365e8c8002a458%40group.calendar.google.com&ctz=America%2FBelem' },
                { text: 'Dashboard fundos', url: 'https://lookerstudio.google.com/embed/reporting/cde54bf6-cff4-4d3d-a416-58765cd2c894/page/Z0wDF' },
                { text: 'Dashboard contratos', url: 'https://lookerstudio.google.com/embed/reporting/74748bad-da33-4d1a-9faa-5c8502e76264/page/lxfEF' },
                { text: 'Solicitação/memo', url: 'https://docs.google.com/forms/d/e/1FAIpQLSfWcVKmB0I75oSL3fj2qAt3shtOZ97AgTRdW_7ehH0Bz90iQA/viewform?embedded=true' },
                { text: 'Memos Lançados', url: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRDrOq9QJjLjm825s9w7E1Kg-tDR5ONxKTsh-WH6FYdo9tPU_sfLAH4JrKFfendkdx3gTUFUP9guaBL/pubhtml?gid=1844955489&single=true&widget=true&headers=false' },
                { text: 'Câmera IP Intelbras', url: 'http://10.131.176.13/' }
            ],
            contratos: [
                { text: 'Email', url: 'https://mail.parauapebas.pa.gov.br/' },
                { text: 'Agenda', url: 'https://calendar.google.com/calendar/embed?src=31521d58fdb5f7855743d3410dfa9d44390e0d314cd1aa38dd365e8c8002a458%40group.calendar.google.com&ctz=America%2FBelem' },
                { text: 'Contratos', submenu: [
                    { text: 'Entrada', url: 'https://docs.google.com/forms/d/e/1FAIpQLSdUjLewIPNNxu32XeaqE1k94qInzw1KMvxsM_ww1_CKTRwNjQ/viewform?embedded=true' },
                    { text: 'Saída', url: 'https://docs.google.com/forms/d/e/1FAIpQLSdjdAg6n-lAOO9fLWOzHDhj4-SluXFOJJNRXE8St6cS5wfn9g/viewform?embedded=true' },
                    { text: 'Lançamentos - Entrada', url: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRDrOq9QJjLjm825s9w7E1Kg-tDR5ONxKTsh-WH6FYdo9tPU_sfLAH4JrKFfendkdx3gTUFUP9guaBL/pubhtml?gid=1207851381&single=true&widget=true&headers=false' },
                    { text: 'Lançamentos - Saída', url: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRDrOq9QJjLjm825s9w7E1Kg-tDR5ONxKTsh-WH6FYdo9tPU_sfLAH4JrKFfendkdx3gTUFUP9guaBL/pubhtml?gid=1850767781&single=true&widget=true&headers=false' }
                ]},
                { text: 'Água', submenu: [
                    { text: 'Entrada - Água', url: 'https://docs.google.com/forms/d/e/1FAIpQLSc10ItjiF5MHW0tOQ4W0lMTOJhK54ge5yh0TmumzFscajM/viewform?embedded=true' },
                    { text: 'Saída - Água', url: 'https://docs.google.com/forms/d/e/1FAIpQLSe1Z_uyTShrd-gXnbMB3gDPBYzgaIrnXcRuNVQfs4DyKoo/viewform?embedded=true' }
                ]},
                { text: 'Câmera IP Intelbras', url: 'http://10.131.176.13/' }
            ],
            fundos: [
                { text: 'Email', url: 'https://mail.parauapebas.pa.gov.br/' },
                { text: 'Agenda', url: 'https://calendar.google.com/calendar/embed?src=b9af275475acd50103f739fab3e27706b1ccddc814033c99543ad7740663dc09%40group.calendar.google.com&ctz=America%2FBelem' },
                { text: 'Entrada', url: 'https://docs.google.com/forms/d/e/1FAIpQLScLJYX5PFWfah-b0K6aF-hH8oO4GNzmzoeiywcptSN83SvoJw/viewform?embedded=true' },
                { text: 'Saída', url: 'https://docs.google.com/forms/d/e/1FAIpQLSftaxIc5VOK6K8AB-f5bcz5YLdMqmaA6BKYwY4tWfN17lz-_w/viewform?embedded=true' },
                { text: 'Lançamentos - Entrada', url: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRDrOq9QJjLjm825s9w7E1Kg-tDR5ONxKTsh-WH6FYdo9tPU_sfLAH4JrKFfendkdx3gTUFUP9guaBL/pubhtml?gid=1160054884&single=true&widget=true&headers=false' },
                { text: 'Lançamentos - Saída', url: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRDrOq9QJjLjm825s9w7E1Kg-tDR5ONxKTsh-WH6FYdo9tPU_sfLAH4JrKFfendkdx3gTUFUP9guaBL/pubhtml?gid=530975228&single=true&widget=true&headers=false' },
                { text: 'Câmera IP Intelbras', url: 'http://10.131.176.13/' }
            ],
            support: [
                { text: 'Email', url: 'https://mail.parauapebas.pa.gov.br/' },
                { text: 'Agenda', url: 'https://calendar.google.com/calendar/embed?src=31521d58fdb5f7855743d3410dfa9d44390e0d314cd1aa38dd365e8c8002a458%40group.calendar.google.com&ctz=America%2FBelem' },
                { text: 'Form controle A4', url: 'https://docs.google.com/forms/d/e/1FAIpQLSdVA4gBTK2rsN_w7ptw4hia48hLtebmIiX1ICzTdGfOzwZOEA/viewform?embedded=true' },
                { text: 'Planilha controle A4', url: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSJk7K7VJZ28FqEjUeiwVCSvqyHibc7LRaaR2WGJZTHnZhtyqn-W6YLHp1MuMZOeR7v8uBiTW9_tEh_/pubhtml' },
                { text: 'Câmera IP Intelbras', url: 'http://10.131.176.13/' }
            ]
        };

        const calendarUrls = {
            admin: 'https://calendar.google.com/calendar/embed?src=31521d58fdb5f7855743d3410dfa9d44390e0d314cd1aa38dd365e8c8002a458%40group.calendar.google.com&ctz=America%2FBelem',
            contratos: 'https://calendar.google.com/calendar/embed?src=31521d58fdb5f7855743d3410dfa9d44390e0d314cd1aa38dd365e8c8002a458%40group.calendar.google.com&ctz=America%2FBelem',
            fundos: 'https://calendar.google.com/calendar/embed?src=b9af275475acd50103f739fab3e27706b1ccddc814033c99543ad7740663dc09%40group.calendar.google.com&ctz=America%2FBelem',
            support: 'https://calendar.google.com/calendar/embed?src=31521d58fdb5f7855743d3410dfa9d44390e0d314cd1aa38dd365e8c8002a458%40group.calendar.google.com&ctz=America%2FBelem'
        };

        let selectedUser = null;
        const jsConfetti = new JSConfetti();
        let currentIframeIndex = 0;

        function clearAgendaContent() {
            const agenda = document.getElementById('agenda');
            const children = Array.from(agenda.children);
            children.forEach(child => {
                if (child.id !== 'loading-overlay' && child.id !== 'carousel') {
                    child.remove();
                }
            });
            document.getElementById('carousel').style.display = 'none';
        }

        function loadIframe(container, url, id, attributes = {}) {
            clearAgendaContent();
            const agenda = document.getElementById('agenda');
            const iframeContainer = document.createElement('div');
            iframeContainer.classList.add(container);

            const uniqueUrl = url + (url.includes('?') ? '&' : '?') + 't=' + Date.now();
            const iframe = document.createElement('iframe');
            iframe.id = id;
            iframe.src = uniqueUrl;
            iframe.onload = hideLoading;
            iframe.onerror = handleIframeError;
            Object.entries(attributes).forEach(([key, value]) => iframe.setAttribute(key, value));

            iframeContainer.appendChild(iframe);
            agenda.appendChild(iframeContainer);
            document.getElementById('loading-overlay').style.display = 'flex';
        }

        function showFullscreenImage(src) {
            const modal = document.createElement('div');
            modal.className = 'fullscreen-modal';
            modal.innerHTML = `<img src="${src}" class="fullscreen-image" alt="Imagem em tela cheia">`;
            modal.onclick = closeFullscreenImage;
            document.body.appendChild(modal);
        }

        function closeFullscreenImage() {
            const modal = document.querySelector('.fullscreen-modal');
            if (modal) {
                modal.remove();
            }
        }

        function loadBirthdays() {
            clearAgendaContent();
            const agenda = document.getElementById('agenda');
            const calendarContainer = document.createElement('div');
            calendarContainer.classList.add('birthday-calendar');
            calendarContainer.innerHTML = `
                <h1>Calendário de Aniversários 2025</h1>
                <div class="calendar-grid" id="calendar-grid"></div>
            `;
            agenda.appendChild(calendarContainer);

            const birthdays = [
                { name: "Alessandra", date: "10-05", photo: "https://i.imgur.com/oiOqPMF.jpg" },
                { name: "André", date: "04-12", photo: "https://i.imgur.com/KOE75om.jpg" },
                { name: "Antônio", date: "12-06", photo: "https://i.imgur.com/I0Zf5sb.jpg" },
                { name: "Bruno", date: "10-22", photo: "https://i.imgur.com/YjTnnm0.jpg" },
                { name: "Célia", date: "11-28", photo: "https://i.imgur.com/Ia6qcP0.jpg" },
                { name: "Edimilson", date: "11-13", photo: "https://i.imgur.com/MKWpj4H.jpg" },
                { name: "Ednaldo", date: "10-19", photo: "https://i.imgur.com/BPpsMPd.jpg" },
                { name: "Fabiana", date: "04-17", photo: "https://i.imgur.com/0ZvbFv3.jpg" },
                { name: "Luana", date: "12-24", photo: "https://i.imgur.com/F21h35g.jpg" },
                { name: "Raimunda", date: "01-30", photo: "https://i.imgur.com/1tGoRYW.jpg" },
                { name: "Rosália", date: "02-21", photo: "https://i.imgur.com/xOeADBe.jpg" },
                { name: "Simone", date: "05-29", photo: "https://i.imgur.com/VsRWpP5.jpg" },
                { name: "Vanessa", date: "03-21", photo: "https://i.imgur.com/GXcB2hw.jpg" },
                { name: "Vilma", date: "12-03", photo: "https://i.imgur.com/33TySyl.jpg" }
            ];

            const months = [
                "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
            ];

            const today = new Date();
            const currentMonth = today.getMonth() + 1;
            const currentDay = today.getDate();
            const upcomingBirthdays = birthdays.filter(b => {
                const [bMonth, bDay] = b.date.split("-").map(Number);
                const daysUntilBirthday = ((bMonth - currentMonth) * 30 + (bDay - currentDay) + 360) % 360;
                return daysUntilBirthday <= 7 && daysUntilBirthday >= 0;
            });

            if (upcomingBirthdays.length > 0) {
                const notification = document.createElement('div');
                notification.className = 'birthday-notification';
                notification.innerHTML = `
                    <button class="close-btn" onclick="this.parentElement.remove()">✕</button>
                    <h3>Aniversários Próximos</h3>
                    <ul>
                        ${upcomingBirthdays.map(b => `<li>${b.name} - ${b.date.split("-")[1]}/${b.date.split("-")[0]}</li>`).join('')}
                    </ul>
                `;
                calendarContainer.appendChild(notification);
                jsConfetti.addConfetti({
                    confettiColors: ['#ff0a54', '#ff477e', '#ff85a1', '#f1f2f6', '#4267b2'],
                    confettiRadius: 6,
                    confettiNumber: 300,
                    duration: 3000
                });
            }

            const calendarGrid = document.getElementById("calendar-grid");
            months.forEach((month, index) => {
                const monthDiv = document.createElement("div");
                monthDiv.className = "month";
                monthDiv.innerHTML = `<h2>${month}</h2>`;

                const monthBirthdays = birthdays.filter(b => b.date.startsWith(`${index + 1}`.padStart(2, "0")));
                if (monthBirthdays.length === 0) {
                    monthDiv.innerHTML += "<p>Nenhum aniversariante este mês.</p>";
                } else {
                    monthBirthdays.sort((a, b) => {
                        const dayA = parseInt(a.date.split("-")[1]);
                        const dayB = parseInt(b.date.split("-")[1]);
                        return dayA - dayB;
                    });
                    monthBirthdays.forEach((b) => {
                        const birthdayDiv = document.createElement("div");
                        birthdayDiv.className = "birthday";
                        birthdayDiv.innerHTML = `
                            <img src="${b.photo}" alt="${b.name}" onclick="showFullscreenImage('${b.photo}')">
                            <span>${b.name} - ${b.date.split("-")[1]}/${index + 1}</span>
                        `;
                        monthDiv.appendChild(birthdayDiv);
                    });
                }
                calendarGrid.appendChild(monthDiv);
            });
            hideLoading();
        }

        function handleLogin(event) {
            event.preventDefault();
            const password = document.getElementById('password').value;
            const spinner = document.getElementById('login-spinner');

            spinner.style.display = 'block';

            if (!selectedUser || !mockValidatePassword(selectedUser, password)) {
                alert('Senha inválida!');
                spinner.style.display = 'none';
                return;
            }

            setTimeout(() => {
                localStorage.setItem('userToken', users[selectedUser].token);
                localStorage.setItem('username', selectedUser);
                localStorage.setItem('lastUser', selectedUser);
                
                const loginScreen = document.querySelector('#login-container');
                const sidebar = document.querySelector('#sidebar');
                const content = document.querySelector('#content');
                const topbar = document.querySelector('#topbar');
                const profileLogo = document.querySelector('#profile-logo');
                const profileName = document.querySelector('#profile-name');
                
                loginScreen.style.display = 'none';
                sidebar.classList.add('active');
                content.classList.add('active');
                topbar.classList.add('active');
                profileLogo.src = users[selectedUser].profilePhoto;
                profileLogo.onerror = () => profileLogo.src = 'https://via.placeholder.com/30?text=Logo+Indisponível';
                profileName.textContent = users[selectedUser].name;
                profileName.classList.add('active');
                
                updateMenu(selectedUser);
                if (selectedUser === 'admin') {
                    document.getElementById('carousel').style.display = 'block';
                    showIframe(0);
                } else {
                    loadCalendar(selectedUser);
                }
                spinner.style.display = 'none';
            }, 500);
        }

        function updateMenu(username) {
            try {
                const menu = document.querySelector('#menu');
                menu.innerHTML = '';

                menuOptions[username].forEach(option => {
                    const menuItem = document.createElement('div');
                    const link = document.createElement('a');
                    link.href = '#';
                    link.textContent = option.text;
                    link.classList.add('btn-hover');
                    link.setAttribute('role', 'menuitem');
                    link.setAttribute('aria-label', option.text);

                    if (option.text === 'Agenda') {
                        link.onclick = function () {
                            loadCalendar(username);
                        };
                    } else if (option.text === 'Email' || option.text === 'Câmera IP Intelbras') {
                        link.onclick = function () {
                            window.open(option.url, '_blank');
                            if (option.text === 'Câmera IP Intelbras') {
                                alert('Use as credenciais: Login: admin, Senha: semad@124578');
                            }
                        };
                    } else if (option.text === 'Contratos' || option.text === 'Água') {
                        link.onclick = function (e) {
                            e.preventDefault();
                            const submenu = menuItem.querySelector('.submenu');
                            submenu.classList.toggle('active');
                        };
                    } else {
                        link.onclick = function () {
                            loadForm(option.url);
                        };
                    }

                    menuItem.appendChild(link);

                    if (option.submenu) {
                        const submenu = document.createElement('div');
                        submenu.className = 'submenu';
                        option.submenu.forEach(subOption => {
                            const subLink = document.createElement('a');
                            subLink.href = '#';
                            subLink.textContent = subOption.text;
                            subLink.classList.add('btn-hover');
                            subLink.setAttribute('role', 'menuitem');
                            subLink.setAttribute('aria-label', subOption.text);
                            subLink.onclick = function () {
                                loadForm(subOption.url);
                            };
                            submenu.appendChild(subLink);
                        });
                        menuItem.appendChild(submenu);
                    }

                    menu.appendChild(menuItem);
                });
            } catch (error) {
                console.error('Erro ao atualizar menu:', error);
            }
        }

        function loadForm(formUrl) {
            loadIframe('form-container', formUrl, 'form-iframe', { class: 'active' });
        }

        function loadCalendar(username) {
            loadIframe('calendar-container', calendarUrls[username], 'calendar-iframe', { scrolling: 'no', frameborder: '0' });
        }

        function showIframe(index) {
            const iframes = document.querySelectorAll('.carousel iframe');
            iframes.forEach((iframe, i) => {
                iframe.classList.toggle('active', i === index);
            });
            currentIframeIndex = index;
        }

        function prevIframe() {
            const iframes = document.querySelectorAll('.carousel iframe');
            currentIframeIndex = (currentIframeIndex - 1 + iframes.length) % iframes.length;
            showIframe(currentIframeIndex);
        }

        function nextIframe() {
            const iframes = document.querySelectorAll('.carousel iframe');
            currentIframeIndex = (currentIframeIndex + 1) % iframes.length;
            showIframe(currentIframeIndex);
        }

        function hideLoading() {
            document.getElementById('loading-overlay').style.display = 'none';
        }

        function handleIframeError() {
            document.getElementById('loading-overlay').style.display = 'flex';
        }

        function reloadIframe() {
            const activeIframe = document.querySelector('.carousel iframe.active') || document.querySelector('.agenda iframe');
            if (activeIframe) {
                activeIframe.src = activeIframe.src;
            }
        }

        function toggleDropdown() {
            const dropdown = document.getElementById('dropdown-menu');
            dropdown.classList.toggle('active');
        }

        function logout() {
            localStorage.removeItem('userToken');
            localStorage.removeItem('username');
            localStorage.removeItem('lastUser');
            document.getElementById('login-container').style.display = 'flex';
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('content').classList.remove('active');
            document.getElementById('topbar').classList.remove('active');
            document.getElementById('profile-name').classList.remove('active');
            document.getElementById('menu').innerHTML = '';
            updateLoginScreen();
        }

        function updateLoginScreen() {
            const userList = document.getElementById('user-list');
            const loginForm = document.getElementById('login-form');
            userList.innerHTML = '';
            loginForm.classList.remove('active');
            Object.keys(users).forEach(username => {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-option';
                userDiv.innerHTML = `
                    <img src="${users[username].profilePhoto}" class="user-photo" alt="${users[username].name}" onerror="this.src='https://via.placeholder.com/50?text=Logo+Indisponível';">
                    <span class="user-name">${users[username].name}</span>
                `;
                userDiv.onclick = () => {
                    selectedUser = username;
                    userList.innerHTML = '';
                    loginForm.classList.add('active');
                    document.getElementById('password').focus();
                };
                userList.appendChild(userDiv);
            });
        }

        document.getElementById('sidebar-toggle').onclick = () => {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('content').classList.toggle('active');
        };

        window.onload = () => {
            const token = localStorage.getItem('userToken');
            const lastUser = localStorage.getItem('lastUser');
            if (token && lastUser && users[lastUser] && users[lastUser].token === token) {
                selectedUser = lastUser;
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('sidebar').classList.add('active');
                document.getElementById('content').classList.add('active');
                document.getElementById('topbar').classList.add('active');
                document.getElementById('profile-logo').src = users[selectedUser].profilePhoto;
                document.getElementById('profile-name').textContent = users[selectedUser].name;
                document.getElementById('profile-name').classList.add('active');
                updateMenu(selectedUser);
                if (selectedUser === 'admin') {
                    document.getElementById('carousel').style.display = 'block';
                    showIframe(0);
                } else {
                    loadCalendar(selectedUser);
                }
            } else {
                updateLoginScreen();
            }
        };
    </script>
</body>
</html>
